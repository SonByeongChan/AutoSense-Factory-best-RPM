<!DOCTYPE html> <!-- html ë¬¸ì„œì„ì„ ì„ ì–¸ -->
<html lang="ko">  <!-- í•œêµ­ì–´ í˜ì´ì§€ì„ì„ ëª…ì‹œ -->
<head>
    <meta charset="UTF-8">  <!-- í•œê¸€ ì¸ì½”ë”© ê¹¨ì§ ë°©ì§€ -->
    <title>ì‘ì—…ì ëŒ€ì‹œë³´ë“œ</title>  <!-- ë¸Œë¼ìš°ì € íƒ­ ì œëª© -->

    <!-- âœ… 1. Chart.js ë¨¼ì € -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- âœ… 2. annotation í”ŒëŸ¬ê·¸ì¸ ë‹¤ìŒì— -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- âœ… 3. Chartì— í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ì€ ë¬´ì¡°ê±´ ì´ ë’¤ì—ì„œ ì‹¤í–‰ -->
    <script>
      Chart.register(window['chartjs-plugin-annotation']);
    </script>

<!-- 
    <script>
      // âœ… í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
      Chart.register(Chart.GaugeController, Chart.ArcElement, Chart.Legend, Chart.Title);
    </script> -->

<!-- ----------------------------------------------------- -->
<!--             CSS ì˜ì—­ ( style íƒœê·¸ ì•ˆì— )                -->
<!-- ----------------------------------------------------- -->
    <style>
      /* ì „ì²´ í˜ì´ì§€ ë°°ê²½ ë° í°íŠ¸ ì„¤ì • */
      body {
        background-color: #050525;   /*#1106a5dd   #050525dc*/
        margin: 0;
        font-family: 'Pretendard', sans-serif;
        overflow-x: hidden;
        overflow-y: hidden; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ë§Œ ì°¨ë‹¨ */
      }

      /* ìƒë‹¨ ìƒíƒœë°” (ê³ ì •) */
      .status-header {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          z-index: 999;
          background-color: #050525;
          color: white;
          /* padding: 10px 40px;
          display: flex;
          justify-content: space-between;
          align-items: flex-start; */
          box-sizing: border-box;
          /* border-bottom: 1px solid #333;      êµ¬ë¶„ì„  */
        
      }

      .status-top-row, .status-bottom-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 40px;
      }

      .right-buttons {
        display: flex;
        gap: 10px;
      }

      .status-text {
        font-size: 32px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .status-dot {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background-color: #00e676;  /* ê¸°ë³¸: ì´ˆë¡ìƒ‰ */
        margin-right: 8px;
        vertical-align: middle;
      }

      /* â›” ìë™ ì¡°ì • ì‹¤íŒ¨ ì‹œ: ë¹¨ê°„ìƒ‰ */
      .status-dot.warning {
        background-color: #ff0000;  /* ë¶‰ì€ ê²½ê³ ìƒ‰ */
      }


      .time-line {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 24;
        font-weight: 700;
      }

      .tab-button-group{
        display: flex;
        gap: 10px;
      }

      .tab-btn {
        padding: 10px 20px;
        font-size: 20px;
        border: none;
        border-radius: 8px;
        background-color: black;
        color: white;
        font-weight: bold;
        cursor: pointer;
        border: 1px solid #333333;
        box-shadow: 0 0 7px #00bfff;            /* glow íš¨ê³¼ */
      }
      .tab-btn:hover {
        color: #42a5f5;
      }
      .tab-btn.active:hover {
        color: #42a5f5;
      }
      
      .tab-btn.active {
        background-color: white;
        color: black;
      }
      
      /* ì™¼ìª½ ë²„íŠ¼ */
      .back-button {
        /* position: fixed;
        bottom: 20px;
        left: 20px; */
        font-size: 18px;
        background: white;
        color: black;
        font-weight: bold;
        padding: 8px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        /* z-index: 1001; */
        text-decoration: none;
        border: 1px solid #333333;
        box-shadow: 0 0 7px #00bfff;            /* glow íš¨ê³¼ */
      }
      .back-button:hover {
        color: #42a5f5;
      }

      .tab-pane {
        display: none;
        padding: 20px;
        padding-top: 40px;
      }

      .tab-pane.active {
        display: block;
      }

      /* ========================================== */

      .clock-icon {
        font-size: 28px;
        margin-right: 6px;
      }

      #currentDateTime {
        font-size: 24px;
        font-weight: 700;
      }

      .status-left {
          display: flex;
          flex-direction: column; /* ì„¸ë¡œë¡œ ìŒ“ì´ê²Œ í•¨ */
          align-items: flex-start;    /* ì™¼ìª½ ì •ë ¬ ìœ ì§€ */
          gap: 10px;
      }

      .status-line {
        display: flex;
        align-items: center; /* ğŸ”¹ í…ìŠ¤íŠ¸ê°€ ë¶ˆ ì˜†ì— ë¶™ë„ë¡ */
        gap: 10px;
      }



      .status-right {
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 10px;
      }



      .production-info {
          font-size: 16px;
          font-weight: bold;
          color: white;
          margin: 20px 30px;
      }

      /* ------------------------------------------------------
      âœ… CSS: Grid ë ˆì´ì•„ì›ƒ ê¸°ë³¸ ì„¤ì •
      â†’ ëŒ€ì‹œë³´ë“œ ì¹´ë“œë“¤ì„ 4ì—´ Ã— 4í–‰ êµ¬ì¡°ë¡œ ë°°ì¹˜í•¨
      â†’ ê° ì¹´ë“œëŠ” 'card card-1a', 'card-2' ê°™ì€ í´ë˜ìŠ¤ë¡œ ë°°ì¹˜ ìœ„ì¹˜ ì¡°ì •
      ------------------------------------------------------ */
      /* ğŸ³ */
      .grid-container {
        display: grid;                                /* Grid ë ˆì´ì•„ì›ƒì„ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì„ ì–¸(ê¸°ë³¸ í‹€ ë§Œë“¤ê¸°) */
        grid-template-columns: 1fr;                   /* í•˜ë‚˜ì˜ ì—´(column)ë¡œ ìˆ˜ì§ ë°°ì¹˜ */

        grid-template-rows: auto auto;          /* auto: ì½˜í…ì¸  ë†’ì´ì— ë”°ë¼ í–‰, ì—´ ê¸¸ì´ ìë™ìœ¼ë¡œ ê²°ì •ë¨ */
                    
        gap: 15px;

        margin: 105px auto 0;

        width: 100%;

        max-width: none;
      }

      /* ------------------------------------------------------
      âœ… CSS: ì¹´ë“œ ìš”ì†Œ ê³µí†µ ìŠ¤íƒ€ì¼
      â†’ ëŒ€ì‹œë³´ë“œ ì•ˆì— ë“¤ì–´ê°€ëŠ” ëª¨ë“  "ì •ë³´ ì¹´ë“œ"ì— ê³µí†µ ì ìš©ë¨
      â†’ ì˜ˆ: ìƒì‚°ëŸ‰, ë¡œìŠ¤, ì´ìµë¥ , ì°¨íŠ¸, ì„¼ì„œ í˜„í™© ë“±
      ------------------------------------------------------ */
      .chart-card {
        background: #000000dc;            /*background: #050525dc;*/
        border-radius: 12px;
        border: 1px solid #333333;
        box-shadow: 0 0 7px #00bfff;            /* glow íš¨ê³¼ */
        padding: 10px 20px 20px 20px;
        height: 350px;    /* ë†’ì´ ê³ ì • */
        width: 100%;
        max-width: 1560px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 10px;

      }

      /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì íš¨ê³¼ */
/* .chart-card:hover {
    /* box-shadow: 0 0 10px rgba(45, 74, 74, 0.2); */
/* } */ */

/* ë¶€ë“œëŸ¬ìš´ ì™¸ê³½ì„  ë°œê´‘ íš¨ê³¼ */
.glow-subtle {
    box-shadow: 0 0 5px rgba(45, 74, 74, 0.1);
}

      .grid-2col {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2ì—´ë¡œ ë‚˜ëˆ” */
        gap: 20px;
      }

      /* ê·¸ë˜í”„ ë†’ì´ */
      .chart-canvas-wrapper {
        height: 300px;               /* âœ… ê·¸ë˜í”„ ë†’ì´ ëª…í™•íˆ ì§€ì • */
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 0;
        padding: 0;
      }

      .chart-header-left {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .custom-legend {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 20px;
        color: white;
        margin: 0;
        padding: 0;
      }

      .legend-box {
        width: 18px;
        height: 10px;
        background-color: #00FFB2;  /* ì¤‘ëŸ‰ ìƒ‰ìƒ */
        border: 1px solid white;
        display: inline-block;
        margin-right: 2px;
      }

      .chart-title {
        color: white;
        font-size: 50px;
        font-weight: bold;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
      }

      .product-status {
        color: white;
        font-size: 24px;
        font-weight: bold;
        margin: 0;
        padding: 0;
      }

      canvas {
        width: 100% !important;
        height: 100% !important;  /* âœ… ê·¸ë˜í”„ ë¹„ìœ¨ì„ ìë™ìœ¼ë¡œ ìœ ì§€ */
        background-color: transparent;
        margin: 0 !important;
        padding: 0 !important;
        display: block;
      }


      /* ------------------------------------------------------
      âœ… Grid ìœ„ì¹˜ ì§€ì •: ê° ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ì˜ ì—´/í–‰ ë°°ì¹˜ ì„¤ì •
      â†’ ê¸°ì¤€: .grid-container (4ì—´ x 4í–‰) ë‚´ì—ì„œ ë°°ì¹˜ ìœ„ì¹˜ë¥¼ ì§€ì •
      ------------------------------------------------------ */

      /* ğŸ”¹ ì¹´ë“œ 1a: í˜„ì¬ ì¤‘ëŸ‰ */
      .card-1a {
        grid-column: 1 / 5;     /* ğŸ‘‰ 1ë²ˆ ì—´ë¶€í„° ì‹œì‘í•´ì„œ 2ë²ˆ ì—´ ì „ê¹Œì§€ â†’ ì¦‰, ì²« ë²ˆì§¸ ì—´ */
        grid-row: 1;            /* ğŸ‘‰ ì²« ë²ˆì§¸ í–‰ì— ë°°ì¹˜ */
      }

      /* ğŸ”¹ ì¹´ë“œ 1b: í˜„ì¬ RPM */
      .card-1b {
        grid-column: 1 / 5;     /* ğŸ‘‰ ë‘ ë²ˆì§¸ ì—´ */
        grid-row: 2;            /* ğŸ‘‰ ì²« ë²ˆì§¸ í–‰ */
      }

      .card-back {
        grid-column: 2 / 3;
        grid-row: 3;
      }

      /* ==================== ì—†ëŠ” ë¶€ë¶„ ============== */
      .bottom-button-wrapper {
        position: relative;
        display: block;
        width: 100%;
        margin-top: 10px;
        margin-bottom: 20px;
      }

      /* âœ… íŒì—… í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— ê³ ì • */
      .test-button-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 999; /* íŒì—…ë³´ë‹¤ ì•„ë˜ì— ìˆì–´ì•¼ í•˜ë©´ ë” ì‘ì€ ìˆ˜ */
      }

      .test-button-container button {
        padding: 8px 12px;
        font-size: 12px;
        background: white;
        color: black;
        border: 1px solid #ccc;
        border-radius: 6px;
        cursor: pointer;
      }

      /* =========================================== */
      .popup-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: none;
          justify-content: center;
          align-items: center;
          z-index: 1000;
      }

      .popup-box {
          background: white;
          color: black;
          padding: 30px;
          border-radius: 12px;
          text-align: center;
          width: 300px;
      }

      .popup-box h3 {
          color: red;
      }

      .popup-box button {
          background-color: black;
          color: white;
          border: none;
          padding: 10px 20px;
          margin-top: 15px;
          border-radius: 8px;
          cursor: pointer;
      }



      /* ====================== ì—†ëŠ” ë¶€ë¶„ ================ */
      .button-row-wrapper {

      margin-top: 10px;
      display: flex;
      justify-content: space-between; /* ì™¼ìª½ + ì¤‘ì•™ ì •ë ¬ */
      align-items: center;
      padding: 0px 40px 20px 40px;
      box-sizing: border-box;
      position: relative;
    }


    /* ============================================ */

    /* íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì¶”ê°€ë¨) */
    .tab-buttons {
      position: fixed;
      top: 130px;
      left: 0;
      width: 100%;
      z-index: 998;
      display: flex;
      gap: 10px;
      padding: 20px 30px 24px 30px;
      background-color: #242424;
      box-sizing: border-box;
      border-bottom: 1px solid #444;
    }


    /* ============================= */
    /* .grid-2x2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      padding: 50px 40px;
      background-color: #121212;
    } */
    /* ======================================== */

        .grid-container2 {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        padding: 0 30px;
        margin: 105px auto 0;
        /* margin-top: 0; */
        width: 100;
        max-width: none;
        }


     /* ì•„ë˜ì²˜ëŸ¼ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ grid-containerë¡œ ìœ ì§€í•˜ê³ ,
     í•˜ë‹¨ 2í–‰ 2ì—´ì€ ë‚´ë¶€ì—ì„œ grid-rowë¡œ ë¶„ê¸° --> */
        .grid-2col {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2ì—´ë¡œ ë‚˜ëˆ” */
        gap: 5px;
        }

        .chart-card2 {
        background-color: #000000dc;
        border: 1px solid #333333;
        box-shadow: 0 0 7px #00bfff;            /* glow íš¨ê³¼ */
        border-radius: 12px;
        padding: 16px;
        height: 350px;
        }


        .chart-header2 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0px;
        padding: 0;
        }


        .chart-title2 {
        color: white;
        font-size: 30px;
        font-weight: bold;
        margin: 0px 0px 5px 0px;
        padding: 0;
        }


        #tab2 canvas {
        width: 100% !important;
        height: 294px !important;     /*293.174*/
        background-color: transparent;
        margin: 0 !important;
        padding: 0 !important;
        display: block;
        }


        /* ===========íƒ­3============= */
        /* âœ… í…Œì´ë¸” ì»¨í…Œì´ë„ˆ */
        .log-table-container {
        background-color: #161717;
        padding: 20px;
        border-radius: 12px;
        /* margin-top: 20px; */
        margin: 105px auto 0;
        overflow-x: auto;
        max-height: 60vh;
        }


        /* âœ… í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .log-table {
        width: 100%;
        border-collapse: collapse;
        color: white;
        font-size: 14px;
        }
        


        .log-table th,
        .log-table td {
        border: 1px solid #333;
        padding: 10px;
        text-align: center;
        white-space: nowrap;
        }


        .log-table thead {
        background-color: #1f1f1f;
        font-weight: bold;
        }


        .log-table tbody tr:nth-child(odd) {
        background-color: #222;
        }


      .button-row-wrapper {
      margin-top: 10px;
      display: flex;
      justify-content: space-between; /* ì™¼ìª½ + ì¤‘ì•™ ì •ë ¬ */
      align-items: center;
      padding: 0px 40px 20px 40px;
      box-sizing: border-box;
      position: relative;
    }






    /* ğŸ³ 2025-05-31 ì¶”ê°€ ë¶€ë¶„ */
    #tab3 .scroll-area {
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 10px;
    }



    .button-row-wrapper {
      margin-top: 10px;
      display: flex;
      justify-content: space-between; /* ì™¼ìª½ + ì¤‘ì•™ ì •ë ¬ */
      align-items: center;
      padding: 0px 40px 20px 40px;
      box-sizing: border-box;
      position: relative;
    }

    /* ğŸ³ */
    .grid-container3 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      padding: 0 30px 0px 30px;
      margin: 105px auto 0;
      /* margin-top: 0; */
      width: 100;
      max-width: none;
      box-sizing: border-box;
    }

    /* ğŸ³ */
    .grid-container4 {
      margin-top: 0 !important;
      padding: 0 20px;  /* âœ… tab2ì™€ ë™ì¼í•˜ê²Œ padding ì¶”ê°€ */
    }

    .chart-card3 {
      background-color: #000000dc;
      padding: 10px 20px 20px 20px;
      max-width: 1550px;       /* ì¹´ë“œ ìµœëŒ€ ë„ˆë¹„ */

      border-radius: 12px;
      margin-bottom: 5px;
      border: 1px solid #333333;
      box-shadow: 0 0 7px #00bfff;            /* glow íš¨ê³¼ */

      height: 350px;       /* âœ… ë†’ì´ ê³ ì • */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 100%;
      margin: 0 auto;
    }

    .chart-canvas-wrapper-loss {
      height: 300px;
      padding: 10px;
      box-sizing: border-box;
    }

    #chartLoss {
      width: 100% !important;
      height: 100% !important;
    }


    .chart-card4 {
      background-color: #000000dc;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #333333;
      box-shadow: 0 0 7px #00bfff;            /* glow íš¨ê³¼ */

      height: 400px;       /* âœ… ë†’ì´ ê³ ì • */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }


    /* âœ… í…Œì´ë¸”ì—ë§Œ ìŠ¤í¬ë¡¤ ì ìš© */
    .log-table-scroll {
      max-height: 300px;        /* ì›í•˜ëŠ” ë†’ì´ ì¡°ì ˆ ê°€ëŠ¥ */
      overflow-y: auto;
      border: 1px solid #444;
      border-radius: 8px;
    }


    /* =========== */
    /* âœ… ìë™ ì¡°ì • ì„¸ë¡œì„  ìœ„ì¹˜ ê°•ì¡° ìƒ‰ìƒ */
    .highlight-row {
      background-color: #ff9710 !important;         /*#2ca853*/
      transition: background-color 1s ease;
      font-weight: bold;
    }
/* ==============================================
                         íŒì—…
   ============================================== */
   .popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    color: black;
    padding: 30px;
    z-index: 9999;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
  }
  .popup.active { display: block; }

  .recovery-btn {
    display: none;
    margin-left: 20px;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: 600;
    background-color:  #28a745;        /* ì§„í•œ ë…¹ìƒ‰ */
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    transition: background-color 0.2s ease, transform 0.2s ease;
    font-family: 'Arial', sans-serif;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  .recovery-btn.active { display: inline-block; }

  .recovery-btn:hover {
    background-color: #36ff8a;        /* ë°ì€ ë…¹ìƒ‰ìœ¼ë¡œ ì „í™˜ */
    transform: translateY(-2px);
  }

  .status-header.danger {
    background-color: #dc3545;
  }


  /* âœ… íŒì—… ê²½ê³  ì‹œ ë¹¨ê°„ ë°°ê²½ */
  .warning-background {
    background-color: #dc3545 !important;  /* ì§„í•œ ë¹¨ê°„ ê³„ì—´ */
    transition: background-color 0.3s ease-in-out;
  }

        

    


    








    </style>

</head>


<body>
<!-- ----------------------------------------------------- -->
<!--                      Html ì˜ì—­                         -->
<!-- ----------------------------------------------------- -->
    <!-- ì‹œì‘ ë¶€ë¶„ -->
    <!-- ìƒë‹¨ ìƒíƒœ í—¤ë” -->
    <!-- ìƒë‹¨ ìƒíƒœ í—¤ë”: ì‹œìŠ¤í…œ ê°€ë™ ìƒíƒœ ë° í˜„ì¬ ì‹œê°„ í‘œì‹œ -->
    <div class="status-header" id="statusHeader">
      <div class="status-top-row">
        <div class="status-text">
          <span class="status-dot"></span>
          <span id="systemStatus">ì •ìƒ - ì‹œìŠ¤í…œ ê°€ë™ ì¤‘</span>
        </div>
        <div class="time-line">
          <span class="clock-icon"></span>
          <span id="currentDateTime"></span>
        </div>
      </div>
      <div class="status-bottom-row">
        <div class="tab-button-group">
          <button class="tab-btn active" data-tab="tab1">í˜„ì¬ìƒí™©</button>
          <button class="tab-btn" data-tab="tab2">ì‹œìŠ¤í…œ ìƒíƒœ</button>
          <button class="tab-btn" data-tab="tab3">ìƒí™© ê¸°ë¡ ë³´ê¸°</button>
        </div>
        
        <div class="right-buttons">
          <!-- ê¸°ì¡´ ë°± íˆ¬ ë©”ì¸ ì˜†ì— ì¶”ê°€ -->
          <button id="recoverBtn" class="recovery-btn" onclick="recoverSystem()" style="display: none; background-color: #28a745; color: white; padding: 8px 14px; border: none; border-radius: 5px; cursor: pointer;">
            ì¬ê°€ë™
          </button>
          <a href="{{ url_for('main') }}" class="back-button">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
        
      </div>
    </div>



    <!-- âœ… íƒ­ ë‚´ìš© ì˜ì—­ ìœ ì§€ -->
    <div id="tab1" class="tab-pane active">
      <div class="grid-container">

      <!-- ì¤‘ëŸ‰ ê·¸ë˜í”„ -->
      <div class="chart-card card-1a">
        <div class="chart-header">
          <div class="chart-header-left">
            <h3 class="chart-title">ì¤‘ëŸ‰</h3>
            <div class="custom-legend">
              <span class="legend-box" style="background-color: #00e676;"></span>
              <span class="legend-label" style="color: lime;">ì •ìƒ</span>

              <span class="legend-box" style="background-color: #ffca28; margin-left: 15px;"></span>
              <span class="legend-label" style="color: yellow;">ê²½ê³„</span>

              <span class="legend-box" style="background-color: #e53935; margin-left: 15px;"></span>
              <span class="legend-label" style="color: red;">ì´ìƒ</span>
            </div>
          </div>
          <div class="product-status">í˜„ì¬ ìƒì‚° ì œí’ˆêµ°: <span>0g</span></div>
        </div>

          <div class="chart-canvas-wrapper">
            <canvas id="weightChart"></canvas>
          </div>
        </div>

      <!-- RPM ê·¸ë˜í”„ -->
      <div class="chart-card card-1b">
        <div class="chart-header">
          <div class="chart-header-left">
            <h3 class="chart-title">RPM</h3>
            <div class="custom-legend">
              <span class="legend-box" style="background-color:#2EC9FF;"></span>
              <span>í˜„ì¬ RPM</span>
              <span class="legend-box" style="background-color: #ffb300; margin-left: 15px;"></span>
              <span>ì¶”ì²œ RPM</span>
            </div>
          </div>
        </div>
        <div class="chart-canvas-wrapper">
          <canvas id="rpmChart"></canvas>
        </div>
      </div>


    </div>
  </div>


    <!-- âœ… íƒ­2: ì˜¨ë„ 3ê°œ + RPM ê²Œì´ì§€ (2x2 ë°°ì—´) -->
    <div id="tab2" class="tab-pane">
      <div class="grid-container2">
        <!-- í•˜ë‹¨ 2í–‰ Ã— 2ì—´ -->
        <div class="grid-2col">

          <!-- ìŠ¤í¬ë¥˜ -->
          <div class="chart-card2" style="display: flex; gap: 20px;">
            <video src="/static/video/ìŠ¤í¬ë¥˜_2.mp4" autoplay loop muted style="width: 50%; border-radius: 12px;"></video>
            <div style="width: 50%;">
              <div class="chart-header2">
                <h3 class="chart-title2">ìŠ¤í¬ë¥˜ ì˜¨ë„</h3>
                <div class="custom-legend">
                  <span class="legend-box" style="background-color: red;"></span>
                  <span class="legend-label">ìŠ¤í¬ë¥˜ ì˜¨ë„</span>
                </div>
              </div>
              <canvas id="screwTempChart"></canvas>
            </div>
          </div>

          <!-- ì±”ë²„ -->
          <div class="chart-card2" style="display: flex; gap: 20px;">
            <video src="/static/video/ì±”ë²„3.mp4" autoplay loop muted style="width: 50%; border-radius: 12px;"></video>
            <div style="width: 50%;">
              <div class="chart-header2">
                <h3 class="chart-title2">ì±”ë²„ ì˜¨ë„</h3>
                <div class="custom-legend">
                  <span class="legend-box" style="background-color: orange;"></span>
                  <span class="legend-label">ì±”ë²„ ì˜¨ë„</span>
                </div>
              </div>
              <canvas id="chamberTempChart"></canvas>
            </div>
          </div>

          <!--ë…¸ì¦ -->
          <div class="chart-card2" style="display: flex; gap: 20px;">
            <video src="/static/video/ë…¸ì¦.mp4" autoplay loop muted style="width: 50%; border-radius: 12px;"></video>
            <div style="width: 50%;">
              <div class="chart-header2">
                <h3 class="chart-title2">ë…¸ì¦ ì˜¨ë„</h3>
                <div class="custom-legend">
                  <span class="legend-box" style="background-color: yellow;"></span>
                  <span class="legend-label">ë…¸ì¦ ì˜¨ë„</span>
                </div>
              </div>
              <canvas id="outputTempChart"></canvas>
            </div>
          </div>

          <!-- ì¹¼ë‚  -->
          <div class="chart-card2" style="display: flex; gap: 20px;">
            <video src="/static/video/rpm_v.mp4" autoplay loop muted style="width: 50%; border-radius: 12px;"></video>
            <div style="width: 50%;">
              <div class="chart-header2">
                <h3 class="chart-title2">ì¹¼ë‚  RPM</h3>
                <div class="custom-legend">
                  <span class="legend-box" style="background-color: cyan;"></span>
                  <span class="legend-label">ì¹¼ë‚  RPM</span>
                </div>
              </div>
              <canvas id="knifeRpmChart"></canvas>
            </div>
          </div>

        </div>
      </div>
    </div>


<div id="tab3" class="tab-pane">
  <!-- âœ… ìë™ ì¡°ì • ì‹¤íŒ¨ ê¸°ë¡ í…Œì´ë¸” -->
  <div class="grid-container3">  <!-- ğŸ³ 2025-05-31 ìˆ˜ì • -->
    <div class="chart-card3">
      <div class="chart-header">
        <h3 class="chart-title">
          ìë™ ì¡°ì • ê¸°ë¡</h3>
      </div>

      <div class="log-table-scroll">
        <table class="log-table">
          <thead>
            <tr>
              <th>ì‹œê°„</th>
              <th>ì¤‘ëŸ‰</th>
              <th>RPM_pv</th>
              <th>RPM_sv</th>
              <th>ìŠ¤í¬ë¥˜ ì˜¨ë„_pv</th>
              <th>ìŠ¤í¬ë¥˜ ì˜¨ë„_sv</th>
              <th>ì±”ë²„ ì˜¨ë„_pv</th>
              <th>ì±”ë²„ ì˜¨ë„_sv</th>
              <th>ì‚¬ì¶œ ì˜¨ë„_pv</th>
              <th>ì‚¬ì¶œ ì˜¨ë„_sv</th>
            </tr>
          </thead>
          <tbody id="log-table-body">
            <!-- JSë¡œ í–‰ ì¶”ê°€ -->
          </tbody>
        </table>
      </div>
    </div>
    <div class="chart-card3">
      <div class="chart-header">
        <h3 class="chart-title">ì‹œê°„ëŒ€ë³„ ì†ì‹¤ëŸ‰</h3>
      </div>
      <div class="chart-canvas-wrapper chart-canvas-wrapper-loss">
    <canvas id="chartLoss"></canvas>
  </div>
</div>

  </div>
</div>


    <!-- âœ… íƒ­ ì „í™˜ JS ì¶”ê°€ -->
    <script>
      // í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰
      document.addEventListener("DOMContentLoaded", () => {
        const buttons = document.querySelectorAll(".tab-btn");
        const panes = document.querySelectorAll(".tab-pane");

        buttons.forEach(btn => {
          btn.addEventListener("click", () => {
            // ëª¨ë“  ë²„íŠ¼ê³¼ íƒ­ ë¹„í™œì„±í™”
            buttons.forEach(b => b.classList.remove("active"));
            panes.forEach(p => p.classList.remove("active"));

            // í´ë¦­í•œ ë²„íŠ¼ê³¼ í•´ë‹¹ íƒ­ í™œì„±í™”
            btn.classList.add("active");
            const target = btn.getAttribute("data-tab");
            document.getElementById(target).classList.add("active");
          });
        });
      });
      </script>


<!-- --------------------------------------- -->
<!-- ìœ„í—˜ ìƒíƒœ ë°œìƒ ì‹œ ë„ì›Œì§ˆ íŒì—… êµ¬ì„± (ì²˜ìŒì—” ìˆ¨ê¹€ ìƒíƒœ) -->
<div id="warningPopup" class="popup-overlay" style="display: none;">
  <div class="popup-box">
    <h3>âš ï¸ ìœ„í—˜</h3>
    <p>ìë™ ì¡°ì • ì‹¤íŒ¨<br>ê°œì… í•„ìš”</p>
    <button onclick="closeWarningPopup()">í™•ì¸</button>
    {# 'í™•ì¸' ë²„íŠ¼ í´ë¦­ ì‹œ goToSystem() í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ í˜ì´ì§€ ì´ë™ ë“±ì„ ì²˜ë¦¬ #}
  </div>
</div>

<!-- ----------------------------------------------------- -->
<!--              Js ì˜ì—­ ( script íƒœê·¸ ì•ˆì— )               -->
<!-- ----------------------------------------------------- -->
  <script>
    // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸: ê°€ì¥ ìœ„ì—
    let chartUpdatePaused = false;
    let redTimestamps = [];

    function updateDateTime() {
      const now = new Date();
      const date = now.toISOString().split('T')[0];
      const time = now.toTimeString().split(' ')[0];
      document.getElementById('currentDateTime').textContent = `${date} ${time}`;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
    let weightChart, rpmChart;
    let scaleData = [], rpmData = [], recommendedData = [], colors = [], labels = [], index = 0;
    // let changePoints = []; // ì„¸ë¡œì„  ìœ„ì¹˜ë¥¼ ìœ„í•œ ë°°ì—´
    let changeLineIndexes = [];
    // =========================ğŸ³
    let redDotTimestamps

    // APIì—ì„œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°
    fetch('/api/production')
      .then(res => res.json())
      .then(data => {
        scaleData = data.values;        // ì¤‘ëŸ‰
        // rpmData = data.k_rpm_pv;        // í˜„ì¬ íƒ­1 RPM
        rpmData = data.current_rpm;        // í˜„ì¬ íƒ­1 RPM
        colors = data.point_colors;     
        recommendedData = data.recommended_rpm;     // ì¶”ì²œ RPM
        changePoints = data.change_points || [];  // ì„¸ë¡œì„  í¬ì¸íŠ¸
        changeLineIndexes = data.change_points || [];  // ì„¸ë¡œì„  í¬ì¸íŠ¸
        
        initCharts();
        setInterval(updateCharts, 100);     // 150
        updateLossChart(data.labels, data.loss_values);
      });

    // ğŸ³
    function getInitialLabels() {
      const now = new Date();
      const labels = [];
      for (let i = 49; i >= 0; i--) {
        const past = new Date(now.getTime() - i * 1000);
        labels.push(past.toLocaleTimeString('en-GB', {
          hour12: false,
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        }));
      }
      return labels;
    }


    const rpmChangeLinePlugin = {
      id: 'rpm_change_lines',
      afterDraw(chart) {
        const { ctx, chartArea: { top, bottom }, scales: { x } } = chart;
        ctx.save();
        ctx.strokeStyle = 'red';
        ctx.setLineDash([4, 4]);
        ctx.lineWidth = 1.5;

        const visibleLabels = chart.data.labels;
        changeLineIndexes.forEach(globalIndex => {
          const localIndex = globalIndex - (index - visibleLabels.length + 1);
          if (localIndex < 0 || localIndex >= visibleLabels.length) return;

          const xCoord = x.getPixelForValue(localIndex);
          if (isNaN(xCoord)) return;

          ctx.beginPath();
          ctx.moveTo(xCoord, top);
          ctx.lineTo(xCoord, bottom);
          ctx.stroke();
        });

        ctx.restore();
      }
    };


    function initCharts() {
      const weightCtx = document.getElementById('weightChart').getContext('2d');
      const rpmCtx = document.getElementById('rpmChart').getContext('2d');
      const ê¸°ì¤€ì¤‘ëŸ‰ = 3.0;
      const initialLabels = getInitialLabels();

      // ì¤‘ëŸ‰ ì°¨íŠ¸
      weightChart = new Chart(weightCtx, {
        type: 'line',
        data: {
          labels: initialLabels,
          datasets: [{ label: 'ì¤‘ëŸ‰', data: Array(50).fill(null), borderColor: '#00FFB2', borderWidth: 5, fill: false, tension: 0.4, pointBackgroundColor: Array(50).fill('white'), pointRadius: Array(50).fill(5), pointBorderWidth: 1, pointHoverRadius: 8 }]
        },
        options: {
          animation : {duration:100, easing : 'easeOutCirc',      // duration: í•œ ë²ˆì˜ ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ (ms), easing: ì• ë‹ˆë©”ì´ì…˜ ê³¡ì„ (ìì—°ìŠ¤ëŸ¬ìš´ íë¦„)
            animations: {
              y: { easing: 'easeOutCirc'   // yì¶• ê°’ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ ì œê±°
              } // ì• ë‹ˆë©”ì´ì…˜ í›„ë³´: 'easeOutCirc', 'easeInOutCirc'
            }
          },   
          responsive: true,
          maintainAspectRatio: false,
          layout: {
            padding: 0
          },
          scales: { x: { ticks: { maxTicksLimit: 10, font: {size: 24, weight: 'bold'}, color: '#ccc', padding: 10 }, grid: { color: '#333' } }, y: { ticks: { font: { size: 24}, stepSize: 0.1, color: '#ccc' }, grid: { color: '#333' }, suggestedMin: 2.6, suggestedMax: 3.4 } },
          plugins: {
        legend: { display: false },
        annotation: {
          annotations: {
            upperWarning: {
              type: 'line',
              yMin: ê¸°ì¤€ì¤‘ëŸ‰ + 0.15,
              yMax: ê¸°ì¤€ì¤‘ëŸ‰ + 0.15,
              borderColor: 'yellow',
              borderDash: [8, 4],
              borderWidth: 2,
              label: {
                // content: 'ê²½ê³  (3.15g)',
                enabled: true,
                position: 'end',
                backgroundColor: 'transparent',
                color: 'yellow'
              }
            },
            lowerWarning: {
              type: 'line',
              yMin: ê¸°ì¤€ì¤‘ëŸ‰ - 0.03,
              yMax: ê¸°ì¤€ì¤‘ëŸ‰ - 0.03,
              borderColor: 'yellow',
              borderDash: [8, 4],
              borderWidth: 2,
              label: {
                // content: 'ê²½ê³  (2.97g)',
                enabled: true,
                position: 'end',
                backgroundColor: 'transparent',
                color: 'yellow'
              }
            },
            upperDanger: {
              type: 'line',
              yMin: ê¸°ì¤€ì¤‘ëŸ‰ + 0.3,
              yMax: ê¸°ì¤€ì¤‘ëŸ‰ + 0.3,
              borderColor: 'red',
              borderDash: [4, 2],
              borderWidth: 2,
              label: {
                // content: 'ìœ„í—˜ (3.3g)',
                enabled: true,
                position: 'end',
                backgroundColor: 'transparent',
                color: 'red'
              }
            },
            lowerDanger: {
              type: 'line',
              yMin: ê¸°ì¤€ì¤‘ëŸ‰ - 0.05,
              yMax: ê¸°ì¤€ì¤‘ëŸ‰ - 0.05,
              borderColor: 'red',
              borderDash: [4, 2],
              borderWidth: 2,
              label: {
                // content: 'ìœ„í—˜ (2.95)',
                enabled: true,
                position: 'end',
                backgroundColor: 'transparent',
                color: 'red'
              }
            }
          }
        }
      }
    }
  });

      // rpm ì°¨íŠ¸
      rpmChart = new Chart(rpmCtx, {
        type: 'line',
        data: {
          labels: initialLabels,
          datasets: [
            {
              label: 'í˜„ì¬ RPM', data: Array(50).fill(null), borderColor: '#2EC9FF', borderWidth: 5, fill: false, tension: 0.4, pointBackgroundColor: Array(50).fill('blue'), pointRadius: 5, pointBorderWidth: 1, pointHoverRadius: 8 },
            {
              label: 'ì¶”ì²œ RPM', data: Array(50).fill(null), borderColor: '#ffb300', borderWidth: 5, fill: false, tension: 0.4, pointBackgroundColor: Array(50).fill('orange'), pointRadius: 5, pointBorderWidth: 1, pointHoverRadius: 8 }]
        },
        options: {
          animation : {duration:100, easing : 'easeOutCirc'},
          responsive: true,
          maintainAspectRatio: false,
          scales: { x: { ticks: { maxTicksLimit: 10, font: {size:24, weight: 'bold'}, color: '#ccc', padding: 10 }, grid: { color: '#333' } }, y: { ticks: { font: { size: 24 }, stepSize: 0.5, color: '#ccc' }, grid: { color: '#333' }, min: 130, max: 200 } },
          plugins: { title: {display: false}, legend: { display: false, position: 'top', align: 'center', labels: { color: '#ccc', font: { size: 14 }, padding: 8 } } }
        },
        plugins: [rpmChangeLinePlugin]
      });


      
    }


    // ì¤‘ëŸ‰ ê°’ì— ë”°ë¼ ì  í¬ê¸° ì¡°ì ˆ í•¨ìˆ˜
    function getPointRadius(value) {
      if (value <= 2.95 || value >= 3.3) return 11;       // ë¹¨ê°„ ì : ì´ìƒì¹˜
      else if ((value >= 3.15 && value < 3.3) || (value > 2.95 && value <= 2.97)) return 9;  // ë…¸ë€ ì : ê²½ê³„ê°’
      else return 5;                                  // ì´ˆë¡ ì ì : ì •ìƒ 5
    }


    function updateCharts() {

      if (chartUpdatePaused) return;  // ğŸ”´ ì—…ë°ì´íŠ¸ ì •ì§€


      if (index < scaleData.length) {
        const now = new Date();
        const label = now.toLocaleTimeString('en-GB', { hour12: false });

        // ì¤‘ëŸ‰ ê·¸ë˜í”„
        if (weightChart.data.labels.length >= 50) {
          weightChart.data.labels.shift();
          weightChart.data.datasets[0].data.shift();
          weightChart.data.datasets[0].pointBackgroundColor.shift();
          weightChart.data.datasets[0].pointRadius.shift();
        }
        weightChart.data.labels.push(label);
        weightChart.data.datasets[0].data.push(scaleData[index]);
        weightChart.data.datasets[0].pointBackgroundColor.push(colors[index] || 'white');
        weightChart.data.datasets[0].pointRadius.push(getPointRadius(scaleData[index]));
        weightChart.update('none');   // ì• ë‹ˆë©”ì´ì…˜ on/off

        // ê²½ê³  ì¡°ê±´ ì²˜ë¦¬
        if (colors?.[index] === 'red') {
          redTimestamps.push(now);
          redTimestamps = redTimestamps.filter(t => now - t <= 60000);
          
          const popupVisible = document.getElementById('warningPopup')?.style.display === 'flex';
        


          if (redTimestamps.length >= 20 && !popupVisible) {
            triggerWarningPopup();
          }
        }

        // RPM ê·¸ë˜í”„ (í˜„ì¬ + ì¶”ì²œ)
        if (typeof rpmData[index] === 'number' && !isNaN(rpmData[index]) && 
            typeof recommendedData[index] === 'number' && !isNaN(recommendedData[index])
          ) {
          if (rpmChart.data.labels.length >= 50) {
            rpmChart.data.labels.shift();
            rpmChart.data.datasets[0].data.shift(); // í˜„ì¬
            rpmChart.data.datasets[1].data.shift(); // ì¶”ì²œ
          }
          rpmChart.data.labels.push(label);
          rpmChart.data.datasets[0].data.push(rpmData[index]);  // í˜„ì¬ RPM
          rpmChart.data.datasets[1].data.push(recommendedData[index])   // ì¶”ì²œ RPM

          // ì„¸ë¡œì„  ì¶”ê°€ ì¡°ê±´ í™•ì¸
          // if (changePoints.includes(index)) {
          //   const annotationId = `line-${index}`;
          //   if (!rpmChart.options.plugins.annotation.annotations[annotationId]) {
          //     rpmChart.options.plugins.annotation.annotations[annotationId] = {
          //       type: 'line',
          //       xMin: rpmChart.data.labels.length - 1,
          //       xMax: rpmChart.data.labels.length - 1,
          //       borderColor: 'red',
          //       borderWidth: 2,
          //       borderDash: [6, 6],
          //       label: {
          //         content: 'ì¡°ì •ì§€ì ',
          //         enabled: true,
          //         position: 'start',
          //         color: '#ff4444',
          //         font: { size: 12 }
          //       }
          //     };
          //   }
          // }

          
          rpmChart.update('none');
        } else {
          console.warn(`âš ï¸ rpmData[${index}] ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:`, rpmData[index]);
        }

        index++;
      }
    }


    function triggerWarningPopup() {
      document.getElementById('warningPopup').style.display = 'flex';
      document.body.classList.add('warning-background');

      // âœ… ìƒíƒœ ë¬¸êµ¬ ë³€ê²½
      const statusDiv = document.getElementById('systemStatus');
      if (statusDiv) statusDiv.textContent = 'ìë™ ì¡°ì • ì‹¤íŒ¨';

      const dot = document.querySelector('.status-dot');
      if (dot) dot.classList.add('warning');  // â›” ìƒíƒœì¼ ë• ë¶‰ì€ ì 

      const statusHeader = document.getElementById('statusHeader');
      if (statusHeader) statusHeader.classList.add('danger');

      // âœ… ì¬ê°€ë™ ë²„íŠ¼ í‘œì‹œ
      const restartBtn = document.getElementById('recoverBtn');
      if (restartBtn) restartBtn.style.display = 'inline-block';

      // ğŸ”´ ì—¬ê¸°ì— ì¶”ê°€!
      chartUpdatePaused = true;
    }



  </script>

  <script>
  // íƒ­2
  let screwTempChart, chamberTempChart, outputTempChart, knifeRpmChart;
  let c_temp_pv = [], n_temp_pv = [], s_temp_pv = [], k_rpm_pv = [];

  fetch('/api/production')
    .then(res => res.json())
    .then(data => {
      c_temp_pv = data.chamber;
      n_temp_pv = data.output;
      s_temp_pv = data.screw;
      k_rpm_pv = data.k_rpm_pv;

      initTempCharts();
      setInterval(updateTempCharts, 100);
      setInterval(updateLossChart, 100)
    });

  let tempIndex = 0;

  function initTempCharts() {
    // const totalCtx = document.getElementById('totalTempChart').getContext('2d');
    const screwCtx = document.getElementById('screwTempChart').getContext('2d');
    const chamberCtx = document.getElementById('chamberTempChart').getContext('2d');
    const outputCtx = document.getElementById('outputTempChart').getContext('2d');
    const knifeCtx = document.getElementById('knifeRpmChart').getContext('2d');
    const initialLabels = getInitialLabels();

    const tempOptions = {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
        duration: 100,            // ì• ë‹ˆë©”ì´ì…˜ ì†ë„ (ms)
        easing: 'easeOutCirc',    // ë¶€ë“œëŸ¬ìš´ ê³¡ì„ 
        animations: {
          y: { type: 'number', easing: 'linear', duration: 0 }, // âœ… yì¶• ë³€í™” ì‹œ íŠ ì œê±°
        }
      },
      layout: {
        padding: { left: 0 } // ê·¸ë˜í”„ ì „ì²´ ì™¼ìª½ íŒ¨ë”© ì œê±°
      },
      scales: {
        x: {
          ticks: { font: { size: 5 }, color: '#ccc', maxTicksLimit: 10 }, grid: { color: '#333' }
        },
        y: {
          ticks: { font: { size: 24 }, color: '#ccc' }, grid: { color: '#333' }, min: 65, max: 75
        },
      },
      plugins: {
        legend: { display: false, labels: { color: '#ccc' } }
      }
    };


    // ê¹Šì€ ë³µì‚¬ (scales ë‚´ë¶€ê¹Œì§€ ë”°ë¡œ ì“°ê³  ì‹¶ìœ¼ë‹ˆê¹Œ!)
    const knifeOptions = JSON.parse(JSON.stringify(tempOptions));

    delete knifeOptions.scales.y.min;
    delete knifeOptions.scales.y.max;

    // ì¹¼ë‚ ë§Œ Yì¶• ë²”ìœ„ ë”°ë¡œ ì„¤ì •
    knifeOptions.scales.y.suggestedMin = 180;
    knifeOptions.scales.y.suggestedMax = 183;


    screwTempChart = new Chart(screwCtx, {
      type: 'line',
      data: { labels: initialLabels, datasets: [{ label: 'ìŠ¤í¬ë¥˜ ì˜¨ë„', data: Array(50).fill(null), borderColor: 'red' }] },
      options: tempOptions
    });

    chamberTempChart = new Chart(chamberCtx, {
      type: 'line',
      data: { labels: initialLabels, datasets: [{ label: 'ì±”ë²„ ì˜¨ë„', data: Array(50).fill(null), borderColor: 'orange' }] },
      options: tempOptions
    });

    outputTempChart = new Chart(outputCtx, {
      type: 'line',
      data: { labels: initialLabels, datasets: [{ label: 'ë…¸ì¦ ì˜¨ë„', data: Array(50).fill(null), borderColor: 'yellow' }] },
      options: tempOptions
    });

    knifeRpmChart = new Chart(knifeCtx, {
      type: 'line',
      data: { labels: initialLabels, datasets: [{ label: 'ì¹¼ë‚  RPM', data: Array(50).fill(null), borderColor: 'cyan' }] },
      options: knifeOptions
    });
  }

  function updateTempCharts() {

    if (chartUpdatePaused) return;


    if (tempIndex < s_temp_pv.length) {
      const now = new Date();
      const label = now.toLocaleTimeString('en-GB', { hour12: false });

      // ê³µí†µ ì²˜ë¦¬
      [screwTempChart, chamberTempChart, outputTempChart, knifeRpmChart].forEach(chart => {
        if (chart.data.labels.length >= 50) {
          chart.data.labels.shift();
          chart.data.datasets.forEach(ds => ds.data.shift());
        }
        chart.data.labels.push(label);
      });

      // totalTempChart.data.datasets[0].data.push(s_temp_pv[tempIndex]);
      // totalTempChart.data.datasets[1].data.push(c_temp_pv[tempIndex]);
      // totalTempChart.data.datasets[2].data.push(n_temp_pv[tempIndex]);

      screwTempChart.data.datasets[0].data.push(s_temp_pv[tempIndex]);
      chamberTempChart.data.datasets[0].data.push(c_temp_pv[tempIndex]);
      outputTempChart.data.datasets[0].data.push(n_temp_pv[tempIndex]);
      knifeRpmChart.data.datasets[0].data.push(k_rpm_pv[tempIndex]);

      [ screwTempChart, chamberTempChart, outputTempChart, knifeRpmChart].forEach(chart => chart.update('none'));

      tempIndex++;
    }
  }
  </script>
  <script>

let logData = [];   // ì „ì²´ ë°ì´í„° ì €ì¥ìš©
    let logIndex = 0;   // í˜„ì¬ ì¸ë±ìŠ¤
    const tableBody = document.getElementById('log-table-body');

    function populateLogTable() {
      fetch('/api/production')
        .then(res => res.json())
        .then(data => {
          logData = data.log_rows;
          logIndex = 0;
          setInterval(addNextLogRow, 100);  // 1ì´ˆë§ˆë‹¤ í•œ í–‰ì”© ì¶”ê°€
        });
    }

    function addNextLogRow() {

      if (chartUpdatePaused) return;  // ğŸ”´ ì—…ë°ì´íŠ¸ ì •ì§€
      
      if (logIndex < logData.length) {
        const row = logData[logIndex];
        const now = new Date();
        const timeStr = now.toLocaleTimeString('ko-KR', { hour12: false });  // ê³ ì •ëœ í˜„ì¬ ì‹œê°„

        const tr = document.createElement('tr');

        // âœ… ì„¸ë¡œì„  indexì™€ ê°™ìœ¼ë©´ ì´ˆë¡ ê°•ì¡°
        if (changeLineIndexes.includes(logIndex)) {
          tr.classList.add('highlight-row');
        }

        const timeTd = document.createElement('td');
        timeTd.textContent = timeStr;
        tr.appendChild(timeTd);

        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell;
          tr.appendChild(td);
        });

        tableBody.prepend(tr);
        logIndex++;
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      populateLogTable();
    });
  </script>
<script>
      const ê¸°ì¤€ì¤‘ëŸ‰ = 3.0;
      let lossValues = [];
      const lossHistory = Array(24).fill(0);  // âœ… ì‹œê°„ëŒ€ë³„ ëˆ„ì  ì†ì‹¤ëŸ‰ (0ì‹œ~23ì‹œ)
      let chartLoss = null;

      fetch('/api/production')
        .then(res => res.json())
        .then(data => {
          scaleData = data.values;
          labels = data.labels;
          lossValues = scaleData.map(v => Math.abs(v - ê¸°ì¤€ì¤‘ëŸ‰));
          initLossChart();
          setInterval(() => {
            updateLossChart();
            index++;
          }, 1000);
        });

      function initLossChart() {
        const ctx = document.getElementById('chartLoss').getContext('2d');
        chartLoss = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: Array.from({ length: 24 }, (_, i) => `${i}ì‹œ`),
            datasets: [{
              label: 'ì‹œê°„ëŒ€ë³„ ì†ì‹¤ëŸ‰ (g)',
              data: new Array(24).fill(0),
              backgroundColor: 'yellow',
              borderRadius: 4,
            }]
          },
          options: {
            animation : {duration:100, easing : 'easeOutCirc'},
            maintainAspectRatio: false,
            responsive: true,
            plugins: {
              legend: { display: false },
              title: {
                display: false,
                text: 'ì‹œê°„ëŒ€ë³„ ì†ì‹¤ëŸ‰',
                color: '#fff'
              }
            },
            layout: {padding: 0},
            scales: {
              x: {
                ticks: { color: '#fff' },
                grid: { color: '#333' }
              },
              y: {
                beginAtZero: true,
                ticks: { font: {size:24}, color: '#fff' },
                grid: { color: '#333' },
                title: {
                  display: true,
                  text: 'ì†ì‹¤ëŸ‰ (g)',
                  color: '#fff'
                }
              }
            }
          }
        });
      }

      function updateLossChart() {

        if (chartUpdatePaused) return;
        
        if (index < lossValues.length) {
          const now = new Date();
          const hour = now.getHours();
          const loss = Math.abs(lossValues[index]);

          if (!isNaN(loss)) {
            lossHistory[hour] += loss;
          }

          chartLoss.data.datasets[0].data = lossHistory.map(v => v.toFixed(2));
          chartLoss.update();
        }
      }
    </script>

    <script>
      function recoverSystem() {
        // 1. ê·¸ë˜í”„ ë‹¤ì‹œ ì‹œì‘
        chartUpdatePaused = false;

        // 2. ë°°ê²½ìƒ‰ ì›ìƒë³µêµ¬
        document.body.classList.remove('warning-background');

        // 3. ìƒíƒœ ë¬¸êµ¬ ë³µì›
        const statusDiv = document.getElementById('systemStatus');
        if (statusDiv) statusDiv.textContent = 'ì •ìƒ - ì‹œìŠ¤í…œ ê°€ë™ ì¤‘';

        const dot = document.querySelector('.status-dot');
        if (dot) dot.classList.remove('warning');  // âœ… ë³µì› ì‹œ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë˜ëŒë¦¼

        const statusHeader = document.getElementById('statusHeader');
        if (statusHeader) statusHeader.classList.remove('danger');

        // 4. íŒì—… ìˆ¨ê¸°ê¸°
        const popup = document.getElementById('warningPopup');
        if (popup) popup.style.display = 'none';

        // 5. ì¬ê°€ë™ ë²„íŠ¼ ìˆ¨ê¹€
        const restartBtn = document.getElementById('recoverBtn');
        if (restartBtn) restartBtn.style.display = 'none';

        // 6. ë¹¨ê°„ì  ì‹œê°„ ì´ˆê¸°í™”
        redTimestamps = [];
      }

    </script>
    <script>
      // âœ… ê¸°ì¡´ recoverSystem í•¨ìˆ˜ ì•„ë˜ìª½ì— ì¶”ê°€
      function closeWarningPopup() {
        const popup = document.getElementById('warningPopup');
        if (popup) popup.style.display = 'none';

        const restartBtn = document.getElementById('recoverBtn');
        if (restartBtn) restartBtn.style.display = 'inline-block';
      }
    </script>

</body>

</html>